name: TriggerRelease

on:
  workflow_dispatch:

jobs:
  tag:
    runs-on: ubuntu-latest
    timeout-minutes: 5
    permissions:
      contents: write
    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - run: |
          METADATA="$(cargo metadata --format-version=1 --no-deps)"
          VERSION="$(echo $METADATA | jq -r '.packages[0].version')"
          echo "VERSION: $VERSION"
          TAGNAME="v$VERSION"
          echo "TAGNAME: $TAGNAME"
          git config --global user.name github-actions
          git config --global user.email github-actions@github.com
          git tag -a $TAGNAME -m "Tag for $TAGNAME"
          git push origin $TAGNAME
